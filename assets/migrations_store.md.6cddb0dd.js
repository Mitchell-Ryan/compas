import{_ as s,c as n,o as a,a as t}from"./app.cf930e1c.js";const w='{"title":"Store","description":"","frontmatter":{},"headers":[],"relativePath":"migrations/store.md"}',o={},p=t(`<h1 id="store" tabindex="-1">Store <a class="header-anchor" href="#store" aria-hidden="true">#</a></h1><p>This is the current migration state of <code>@compas/store</code> and should be used as your first migration:</p><div class="language-sql"><pre><code><span class="token keyword">CREATE</span> EXTENSION <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token string">&quot;uuid-ossp&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> migration
<span class="token punctuation">(</span>
  <span class="token string">&quot;namespace&quot;</span> <span class="token keyword">varchar</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token string">&quot;number&quot;</span>    <span class="token keyword">int</span><span class="token punctuation">,</span>
  <span class="token string">&quot;name&quot;</span>      <span class="token keyword">varchar</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token string">&quot;createdAt&quot;</span> timestamptz <span class="token keyword">DEFAULT</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">&quot;hash&quot;</span>      <span class="token keyword">varchar</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> migration_namespace_number_idx <span class="token keyword">ON</span> <span class="token string">&quot;migration&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;namespace&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token string">&quot;file&quot;</span>
<span class="token punctuation">(</span>
  <span class="token string">&quot;id&quot;</span>            uuid <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> uuid_generate_v4<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">&quot;contentLength&quot;</span> <span class="token keyword">int</span>              <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token string">&quot;bucketName&quot;</span>    <span class="token keyword">varchar</span>          <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token string">&quot;contentType&quot;</span>   <span class="token keyword">varchar</span>          <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token string">&quot;name&quot;</span>          <span class="token keyword">varchar</span>          <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token string">&quot;meta&quot;</span>          jsonb            <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token string">&quot;createdAt&quot;</span>     timestamptz      <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">&quot;updatedAt&quot;</span>     timestamptz      <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> <span class="token string">&quot;fileBucketNameIdx&quot;</span> <span class="token keyword">ON</span> <span class="token string">&quot;file&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;bucketName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token string">&quot;job&quot;</span>
<span class="token punctuation">(</span>
  <span class="token string">&quot;id&quot;</span>             bigserial <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token string">&quot;isComplete&quot;</span>     <span class="token keyword">boolean</span>               <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token string">&quot;priority&quot;</span>       <span class="token keyword">int</span>                   <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token string">&quot;retryCount&quot;</span>     <span class="token keyword">int</span>                   <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">&quot;name&quot;</span>           <span class="token keyword">varchar</span>               <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token string">&quot;scheduledAt&quot;</span>    timestamptz           <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">&quot;data&quot;</span>           jsonb                 <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token string">&quot;handlerTimeout&quot;</span> <span class="token keyword">int</span>                   <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token string">&quot;createdAt&quot;</span>      timestamptz           <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">&quot;updatedAt&quot;</span>      timestamptz           <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> <span class="token string">&quot;jobIsCompleteScheduledAtIdx&quot;</span> <span class="token keyword">ON</span> <span class="token string">&quot;job&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;isComplete&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;scheduledAt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> <span class="token string">&quot;jobNameIdx&quot;</span> <span class="token keyword">ON</span> <span class="token string">&quot;job&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> <span class="token string">&quot;jobScheduledAtIdx&quot;</span> <span class="token keyword">ON</span> <span class="token string">&quot;job&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;scheduledAt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token string">&quot;jobIsCompleteUpdatedAt&quot;</span> <span class="token keyword">ON</span> <span class="token string">&quot;job&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;isComplete&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;updatedAt&quot;</span><span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token string">&quot;isComplete&quot;</span> <span class="token operator">IS</span> <span class="token boolean">TRUE</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token string">&quot;sessionStore&quot;</span>
<span class="token punctuation">(</span>
  <span class="token string">&quot;id&quot;</span>        uuid <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> uuid_generate_v4<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">&quot;checksum&quot;</span>  <span class="token keyword">varchar</span>          <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token string">&quot;data&quot;</span>      jsonb            <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token string">&quot;revokedAt&quot;</span> timestamptz      <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token string">&quot;createdAt&quot;</span> timestamptz      <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">&quot;updatedAt&quot;</span> timestamptz      <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token string">&quot;sessionStoreToken&quot;</span>
<span class="token punctuation">(</span>
  <span class="token string">&quot;id&quot;</span>           uuid <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> uuid_generate_v4<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">&quot;session&quot;</span>      uuid             <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token string">&quot;expiresAt&quot;</span>    timestamptz      <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token string">&quot;refreshToken&quot;</span> uuid             <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token string">&quot;revokedAt&quot;</span>    timestamptz      <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token string">&quot;createdAt&quot;</span>    timestamptz      <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">CONSTRAINT</span> <span class="token string">&quot;sessionStoreTokenSessionFk&quot;</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token string">&quot;session&quot;</span><span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> <span class="token string">&quot;sessionStore&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">,</span>
  <span class="token keyword">CONSTRAINT</span> <span class="token string">&quot;sessionStoreTokenRefreshTokenFk&quot;</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token string">&quot;refreshToken&quot;</span><span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> <span class="token string">&quot;sessionStoreToken&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> <span class="token string">&quot;sessionStoreTokenSessionIdx&quot;</span> <span class="token keyword">ON</span> <span class="token string">&quot;sessionStoreToken&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;session&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> <span class="token string">&quot;sessionStoreTokenRefreshTokenIdx&quot;</span> <span class="token keyword">ON</span> <span class="token string">&quot;sessionStoreToken&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;refreshToken&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>`,3),e=[p];function c(k,u,l,r,i,d){return a(),n("div",null,e)}var N=s(o,[["render",c]]);export{w as __pageData,N as default};

{{ for (const key of Object.keys(keys)) { }}
{{= validatorsAnonFn(keys[key]) }}
{{ } }}

function {{= functionName }}(value, propertyPath) {
  if (isNil(value)) {
    {{ if (it.isOptional) { }}
      return {{= it.defaultValue }};
    {{ } else { }}
      throw _errorFn("validator.object.undefined", { propertyPath });
    {{ } }}
  }

  if (typeof value !== "object") {
    throw _errorFn("validator.object.type", { propertyPath });
  }
  const result = Object.create(null);

  {{ if (it.validator.strict) { }}
  const keySet = new Set(Object.keys(value));
  {{ } }}

  {{ for (const key of Object.keys(keys)) { }}
    result[{{= quote(key) }}] = {{= keys[key].functionName }}(value[{{= quote(key) }}], propertyPath + "." + {{= quote(key) }});

    {{ if (it.validator.strict) { }}
    keySet.delete({{= quote(key) }});
    {{ } }}
  {{ } }}

  {{ if (it.validator.strict) { }}
  if (keySet.size !== 0) {
    let extraKeys = "";
    for (const k of keySet.keys()) { extraKeys += k + ","; }
    throw _errorFn("validator.object.strict", { propertyPath, extraKeys });
  }
  {{ } }}

  return result;
}
